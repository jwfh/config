#!/bin/bash
command="$1"
profile=$2
shift;
shift;
if [ "" == "logout" ]
then
    command="logout"
fi
if [ -n "$https_proxy" ]; then
    readonly URI_REGEX='^(([^:/?#]+):)?(//((([^:/?#]+)@)?([^:/?#]+)(:([0-9]+))?))?(/([^?#]*))(\?([^#]*))?(#(.*))?'
    [[ $https_proxy =~ ${URI_REGEX} ]] && PROXY_CONFIG="-Dhttps.proxyHost=${BASH_REMATCH[7]} -Dhttps.proxyPort=${BASH_REMATCH[9]}"
fi
env OKTA_PROFILE=$profile java ${PROXY_CONFIG} \
    -Djava.util.logging.config.file="${HOME}/.okta/logging.properties" \
    -classpath "${HOME}/.okta/okta-aws-cli.jar" \
    com.okta.tools.WithOkta $command "$@"
