<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Path MTU discovery</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="Firewalling with OpenBSD's PF packet filter
  "
HREF="index.html"><LINK
REL="UP"
TITLE="Making your network troubleshooting friendly"
HREF="troubleshoot.html"><LINK
REL="PREVIOUS"
TITLE="Helping traceroute"
HREF="helptraceroute.html"><LINK
REL="NEXT"
TITLE="Network hygiene: Blocking, scrubbing and so on"
HREF="hygiene.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="docbook.css"><meta
http-equiv="Content-Type"
content="text/html; charset=ISO-8859-1"></HEAD
><BODY
CLASS="SECTION"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Firewalling with OpenBSD's PF packet filter</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="helptraceroute.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Making your network troubleshooting friendly</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="hygiene.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECTION"
><H1
CLASS="SECTION"
><A
NAME="PATHMTUDISC"
>Path MTU discovery</A
></H1
><P
>The last bit I will remind you about when it comes to troubleshooting
is the 'path MTU discovery'.  Internet protocols are designed to be
device independent, and one consequence of device independence is that
you can not always predict reliably what the optimal packet size is
for a given connection.  The main constraint on your packet size is
called the <I
CLASS="FIRSTTERM"
>Maximum Transmission Unit</I
>, or 
<I
CLASS="FIRSTTERM"
>MTU</I
>, which sets the upper limit on the 
packet size for an interface.  The <SPAN
CLASS="APPLICATION"
>ifconfig</SPAN
> 
command will show you the MTU for your network interfaces.</P
><P
>The way modern TCP/IP implementations work, they expect to be able to
determine the right packet size for a connection through a process
which simply puts involves sending packets of varying sizes with the
'Do not fragment' flag set, expecting an ICMP return packet indicating
"type 3, code 4", when the upper limit has been reached.  Now you
don't need to dive for the RFCs right away.  Type 3 means "destination
unreachable", while code 4 is short for "fragmentation needed, but the
do not fragment flag is set".  So if your connections to networks
which may have other MTUs than your own seem sub-optimal, and you do
not need to be that specific, you could try changing your list of ICMP
types slightly to let the Destination unreachable packets through, too:</P
><PRE
CLASS="PROGRAMLISTING"
>icmp_types = "{ echoreq, unreach }"</PRE
><P
>as we can see, this means we do not need to change the pass rule itself:</P
><PRE
CLASS="PROGRAMLISTING"
>pass inet proto icmp all icmp-type $icmp_types</PRE
><P
>It's also possible to just allow the code 4 of type 3, instead of all codes.</P
><PRE
CLASS="PROGRAMLISTING"
>pass inet proto icmp all icmp-type unreach code needfrag </PRE
><P
>PF lets you filter on all variations of ICMP types and codes, and if
you want to delve into what to pass and not of ICMP traffic, the list
of possible types and codes are documented in the icmp(4) and icmp6(4)
man pages.  The background information is available in the RFCs<A
NAME="AEN1026"
HREF="#FTN.AEN1026"
><SPAN
CLASS="footnote"
>[1]</SPAN
></A
>
.</P
></DIV
><H3
CLASS="FOOTNOTES"
>Notes</H3
><TABLE
BORDER="0"
CLASS="FOOTNOTES"
WIDTH="100%"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.AEN1026"
HREF="pathmtudisc.html#AEN1026"
><SPAN
CLASS="footnote"
>[1]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>The main internet RFCs describing ICMP and some related
techniques are RFC792, RFC950, RFC1191, RFC1256, RFC2521, rfc2765,
while necessary updates for ICMP for IPv6 are found in RFC1885,
RFC2463, RFC2466.  These documents are available in a number of places
on the net, such as the <A
HREF="http://www.ietf.org"
TARGET="_top"
>ietf.org</A
> and <A
HREF="http://www.faqs.org"
TARGET="_top"
>faqs.org</A
> web sites, and probably
also via your package system.</P
><P
>It is quite possible that I will return to ICMP filtering in a future
advanced section of the tutorial.</P
></TD
></TR
></TABLE
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="helptraceroute.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="hygiene.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Helping <SPAN
CLASS="APPLICATION"
>traceroute</SPAN
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="troubleshoot.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Network hygiene: Blocking, scrubbing and so on</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>