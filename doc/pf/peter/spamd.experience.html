<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Some early highlights of our spamd experience</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="Firewalling with OpenBSD's PF packet filter
  "
HREF="index.html"><LINK
REL="UP"
TITLE="Giving spammers a hard time"
HREF="spamd.html"><LINK
REL="PREVIOUS"
TITLE="Setting up spamd"
HREF="spamd.setup.html"><LINK
REL="NEXT"
TITLE="Beating'em up some more: spamdb and greytrapping"
HREF="spamd.greytrapping.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="docbook.css"><meta
http-equiv="Content-Type"
content="text/html; charset=ISO-8859-1"></HEAD
><BODY
CLASS="SECTION"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Firewalling with OpenBSD's PF packet filter</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="spamd.setup.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Giving spammers a hard time</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="spamd.greytrapping.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECTION"
><H1
CLASS="SECTION"
><A
NAME="SPAMD.EXPERIENCE"
>Some early highlights of our <SPAN
CLASS="APPLICATION"
>spamd</SPAN
> experience</A
></H1
><P
>What is <SPAN
CLASS="APPLICATION"
>spamd</SPAN
> like in practical use? We
started using <SPAN
CLASS="APPLICATION"
>spamd</SPAN
> in earnest in early
December of 2004, after running
<SPAN
CLASS="APPLICATION"
>spamassassin</SPAN
> and
<SPAN
CLASS="APPLICATION"
>clamav</SPAN
> as parts of the
<SPAN
CLASS="APPLICATION"
>exim</SPAN
> delivery process for a while. Our
<SPAN
CLASS="APPLICATION"
>exim</SPAN
> is configured to tag and deliver
messages with a spamassassin score in the interval from 5 to 9.99
points, while discarding messages with 10 points or more along with
malware carrying messages.  As the autumn progressed,
<SPAN
CLASS="APPLICATION"
>spamassassin</SPAN
>'s success rate had been
steadily declining, letting ever more spam through.</P
><P
>When we put <SPAN
CLASS="APPLICATION"
>spamd</SPAN
> into production, the
total number of messages handled and the number of messages handled by
<SPAN
CLASS="APPLICATION"
>spamassassin</SPAN
> decreased drastically. The
number of spam messages which make it through untagged is now
stabilized at roughly five a day, based on a reporting population of a
handful of users.</P
><P
>If you start <SPAN
CLASS="APPLICATION"
>spamd</SPAN
> with the -v command line
option for verbose logging, the logs start including a few more items
of information in addition to the IP addresses.  With verbose logging,
a typical log excerpt looks like this:</P
><PRE
CLASS="PROGRAMLISTING"
>Oct  2 19:55:05 delilah spamd[26905]: (GREY) 83.23.213.115: 
&lt;gilbert@keyholes.net&gt; -&gt; &lt;wkitp98zpu.fsf@datadok.no&gt;
Oct  2 19:55:05 delilah spamd[26905]: 83.23.213.115: disconnected after 
0 seconds.
Oct  2 19:55:05 delilah spamd[26905]: 83.23.213.115: connected (2/1)
Oct  2 19:55:06 delilah spamd[26905]: (GREY) 83.23.213.115: 
&lt;gilbert@keyholes.net&gt; -&gt; &lt;wkitp98zpu.fsf@datadok.no&gt;
Oct  2 19:55:06 delilah spamd[26905]: 83.23.213.115: disconnected after 
1 seconds.
Oct  2 19:57:07 delilah spamd[26905]: (BLACK) 65.210.185.131:
 &lt;bounce-3C7E40A4B3@branch15.summer-bargainz.com&gt; -&gt; &lt;adm@dataped.no&gt;
Oct  2 19:58:50 delilah spamd[26905]: 65.210.185.131: From: Auto 
lnsurance Savings &lt;noreply@branch15.summer-bargainz.com&gt;
Oct  2 19:58:50 delilah spamd[26905]: 65.210.185.131: Subject: Start 
SAVlNG M0NEY on Auto lnsurance
Oct  2 19:58:50 delilah spamd[26905]: 65.210.185.131: To: adm@dataped.no
Oct  2 20:00:05 delilah spamd[26905]: 65.210.185.131: disconnected after 
404 seconds. lists: spews1
Oct  2 20:03:48 delilah spamd[26905]: 222.240.6.118: connected (1/0)
Oct  2 20:03:48 delilah spamd[26905]: 222.240.6.118: disconnected after 
0 seconds.
Oct  2 20:06:51 delilah spamd[26905]: 24.71.110.10: connected (1/1), 
lists: spews1
Oct  2 20:07:00 delilah spamd[26905]: 221.196.37.249: connected (2/1)
Oct  2 20:07:00 delilah spamd[26905]: 221.196.37.249: disconnected after 
0 seconds.
Oct  2 20:07:12 delilah spamd[26905]: 24.71.110.10: disconnected after 
21 seconds. lists: spews1</PRE
><P
>The first three lines say that a machine connects, as the second
active connection, with one connection from a blacklisted host. The
<SAMP
CLASS="COMPUTEROUTPUT"
>(GREY)</SAMP
> and
<SAMP
CLASS="COMPUTEROUTPUT"
>(BLACK)</SAMP
> before the addresses indicate
greylisting or blacklisting status, respectively.  After 404 seconds
(or 6 minutes, 44 seconds), the blacklisted host gives up without
completing the delivery.  The following lines may be the first ever
contact from a machine, which is then greylisted.<A
NAME="AEN1739"
HREF="#FTN.AEN1739"
><SPAN
CLASS="footnote"
>[1]</SPAN
></A
></P
><P
>At the time this tutorial was originally written, our preliminary
conclusion was that <SPAN
CLASS="APPLICATION"
>spamd</SPAN
> was quite
efficient in stopping spam.  Unfortunately, along the way we
encountered some false positives.  Indications are that the false
positives came from a few too broadly defined entries in the spews2
(spews level 2) list.  For now we have stopped using this list as a
blacklist, without a noticeable increase in the spam volume.</P
><P
>Now for what used to be the the climax of my spamd experience. One log
entry stood out for a long time:</P
><PRE
CLASS="SCREEN"
>Dec 11 23:57:24 delilah spamd[32048]: 69.6.40.26: connected (1/1), 
lists: spamhaus spews1 spews2
Dec 12 00:30:08 delilah spamd[32048]: 69.6.40.26: disconnected 
after 1964 seconds. lists: spamhaus spews1 spews2</PRE
><P
>This entry concerns a sender at wholesalebandwidth.com. This particular
machine made 13 attempts at delivery during the period from December 9th 
to December 12th, 2004. The last attempt lasted 32 minutes, 44 seconds, 
without completing the delivery.</P
><P
>I update the tutorial now and again, and recently I found a few more entries which exceeded this:</P
><PRE
CLASS="SCREEN"
><SAMP
CLASS="COMPUTEROUTPUT"
>$</SAMP
> <KBD
CLASS="USERINPUT"
>grep disconnected /var/log/spamd | awk '{print $9}' \
| sort -rn | uniq -c | head</KBD
>
<SAMP
CLASS="COMPUTEROUTPUT"
>   1 42673
   1 36099
   1 14714
   1 10170
   1 5495
   1 3025
   1 2193
   1 1964
   1 1872
   1 1718</SAMP
></PRE
><P
>The first, at 42673 seconds, which is almost twelve hours, </P
><PRE
CLASS="SCREEN"
>Dec 21 14:22:44 delilah spamd[29949]: 85.152.224.147: connected (5/2)
Dec 21 14:22:46 delilah spamd[29949]: 85.152.224.147: connected (6/2)
Dec 21 14:22:47 delilah spamd[29949]: 85.152.224.147: disconnected
after 3 seconds.
Dec 22 02:13:59 delilah spamd[29949]: 85.152.224.147: disconnected
after 42673 seconds.</PRE
><P
>concerns a host which is apparently in a Spanish telecoms operator's
network.  The machine was probably infected by an extremely naive spam
sending worm, which just took a long time waiting for the rest of the
SMTP dialogue.  The next entries, at 10 hours, 1 minute, 39 seconds, 4
hours, 5 minutes and 14 seconds and 2 hours, 49 minutes and 30 seconds
respectively, seem to have behaved in much the same way.</P
></DIV
><H3
CLASS="FOOTNOTES"
>Notes</H3
><TABLE
BORDER="0"
CLASS="FOOTNOTES"
WIDTH="100%"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.AEN1739"
HREF="spamd.experience.html#AEN1739"
><SPAN
CLASS="footnote"
>[1]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Note
the rather curious local part (user name) of the address in the
message which the greylisted machine tries to deliver
here.  There is more to this story.</P
></TD
></TR
></TABLE
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="spamd.setup.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="spamd.greytrapping.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Setting up <SPAN
CLASS="APPLICATION"
>spamd</SPAN
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="spamd.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Beating'em up some more: <SPAN
CLASS="APPLICATION"
>spamdb</SPAN
> and greytrapping</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>