<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Setting up a simple wireless network</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="Firewalling with OpenBSD's PF packet filter
  "
HREF="index.html"><LINK
REL="UP"
TITLE="Wireless networks made simple"
HREF="wireless.simple.html"><LINK
REL="PREVIOUS"
TITLE="Wireless networks made simple"
HREF="wireless.simple.html"><LINK
REL="NEXT"
TITLE="An open, yet tightly guarded wireless network with authpf"
HREF="vegard.authpf.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="docbook.css"><meta
http-equiv="Content-Type"
content="text/html; charset=ISO-8859-1"></HEAD
><BODY
CLASS="SECTION"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Firewalling with OpenBSD's PF packet filter</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="wireless.simple.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Wireless networks made simple</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="vegard.authpf.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECTION"
><H1
CLASS="SECTION"
><A
NAME="WIRELESS.SIMPLE.SETUP"
>Setting up a simple wireless network</A
></H1
><P
>The first part is to make sure you have a supported card and check
your <SPAN
CLASS="APPLICATION"
><A
HREF="http://man.openbsd.org/dmesg"
TARGET="_top"
>dmesg</A
></SPAN
> output to see that the driver loads and initializes the
card properly<A
NAME="AEN1398"
HREF="#FTN.AEN1398"
><SPAN
CLASS="footnote"
>[1]</SPAN
></A
> With a successfully
configured card you should see something like</P
><PRE
CLASS="SCREEN"
>ath0 at pci1 dev 4 function 0 "Atheros AR5212" rev 0x01: irq 11
ath0: AR5212 5.6 phy 4.1 rf5111 1.7 rf2111 2.3, ETSI1W, address 
00:0d:88:c8:a7:c4</PRE
><P
>Next, you need to configure the interface for TCP/IP. On OpenBSD, this 
means an <TT
CLASS="FILENAME"
>/etc/hostname.ath0</TT
> roughly like this:</P
><PRE
CLASS="PROGRAMLISTING"
>up media autoselect mediaopt hostap mode 11b chan 6 nwid unwiredbsd \
 nwkey 0x1deadbeef9
inet 10.168.103.1</PRE
><P
>Note that the configuration is divided over two lines.  The first line
generates an ifconfig command which sets up the interface with the
correct parameters for the physical wireless network, the second
command, which gets executed only after the first one completes, sets
the IP address. Note that we set the channel explicitly, and we enable
a weak WEP encryption by setting the <KBD
CLASS="USERINPUT"
>nwkey</KBD
> parameter.</P
><DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="./note.jpg"
HSPACE="5"
ALT="Note"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>From OpenBSD 4.4 onwards, we have WPA, config simplified in OpenBSD 4.9</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>From OpenBSD 4.4 onwards, WPA is available.  To handle WPA keys we used <SPAN
CLASS="APPLICATION"
>wpa-psk</SPAN
>, either from the command line to generate a pasteable key:</P
><PRE
CLASS="SCREEN"
>$ wpa-psk unwiredbsd mylongpassphrase
0x7579c38e59faaa3b64bd8372e94f74fe7ae2e4e91af154c956a9bfd0240ac9d0</PRE
><P
>or directly in your network configuration file. Here is the configuration for a WPA access point, OpenBSD 4.4 style:</P
><PRE
CLASS="PROGRAMLISTING"
>up media autoselect mediaopt hostap mode 11b chan 6 nwid unwiredbsd \
 wpa wpapsk $(wpa-psk unwiredbsd mylongpassphase)</PRE
><P
>In OpenBSD 4.9, the WPA key functionality was merged into <SPAN
CLASS="APPLICATION"
>ifconfig</SPAN
>, and the configuration syntax was simplified. The WPA access point configuration in the OpenBSD 4.9 (and newer) style is:</P
><PRE
CLASS="PROGRAMLISTING"
>up media autoselect mediaopt hostap mode 11b chan 6 nwid unwiredbsd \
 wpakey mylongpassphase</PRE
><P
>and you would need to set up IP addresses and likely DHCP too, of course.</P
></TD
></TR
></TABLE
></DIV
><P
>On FreeBSD you would need to put those lines in your
<TT
CLASS="FILENAME"
>/etc/start_if.ath0</TT
>, and substitute your interface
name for <KBD
CLASS="USERINPUT"
>ath0</KBD
> if required</P
><P
>Then you most likely want to set up <SPAN
CLASS="APPLICATION"
><A
HREF="http://man.openbsd.org/dhcpd"
TARGET="_top"
>dhcpd</A
></SPAN
> to serve addresses and
other relevant network information to clients. Your clients would need
an <TT
CLASS="FILENAME"
>/etc/hostname.ath0</TT
> configuration of </P
><PRE
CLASS="PROGRAMLISTING"
>up media autoselect mode 11b chan 6 nwid unwiredbsd nwkey 0x1deadbeef9
dhcp</PRE
><P
>For a setup with WPA and pre-shared keys corresponding to the access point earlier, you would need something like</P
><PRE
CLASS="PROGRAMLISTING"
>up media autoselect mode 11b chan 6 nwid unwiredbsd \ 
wpa wpapsk $(wpa-psk unwiredbsd mylongpassphase)</PRE
><P
>instead. <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>Note</I
></SPAN
> that the details of setting up WPA for FreeBSD differs somewhat.</P
><P
>and again on FreeBSD, you would need to put those
lines in your <TT
CLASS="FILENAME"
>/etc/start_if.ath0</TT
>, and substitute
your interface name for <KBD
CLASS="USERINPUT"
>ath0</KBD
> here if required.  </P
><P
>Assuming your gateway does NAT, you will want to set up NAT for the
wireless network as well, by making some small changes to your
<TT
CLASS="FILENAME"
>/etc/pf.conf</TT
>:</P
><PRE
CLASS="PROGRAMLISTING"
>air_if = "ath0"</PRE
><P
>and </P
><PRE
CLASS="PROGRAMLISTING"
>nat on $ext_if from $air_if:network to any -&#62; ($ext_if) static-port</PRE
><P
>You will need a similar near duplicate line for your ftp-proxy config,
and include <KBD
CLASS="USERINPUT"
>$air_if</KBD
> in your pass rules.</P
><P
>That's all there is to it. This configuration gives you a functional
BSD access point, with at least token security via WEP encryption, or WPA if your setup includes OpenBSD.</P
><P
>A somewhat more thorough treatment of wireless networks, including setup tips for newer FreeBSD configurations, can be found in <A
HREF="http://www.nostarch.com/pf3"
TARGET="_top"
>The Book of PF</A
>.</P
></DIV
><H3
CLASS="FOOTNOTES"
>Notes</H3
><TABLE
BORDER="0"
CLASS="FOOTNOTES"
WIDTH="100%"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.AEN1398"
HREF="wireless.simple.setup.html#AEN1398"
><SPAN
CLASS="footnote"
>[1]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Wireless network support in OpenBSD and BSDs
in general is getting better all the time, but this does not mean that
getting all the bits you need is necessarily easy. A brief history of
my home network goes like this: I started out buying two CNet CWP-854
cards, which should be supported in OpenBSD 3.7 via the new ral
driver.  The one I put in the brand new Dell machine running a
non-free operating system worked right out of the box.  My gateway,
which had been running without incident since the 3.3 days however,
was a little more problematic.  The card did get recognized and
configured, but once the Dell tried to get an IP address, the gateway
went down with a kernel panic.  The gory details are available as
OpenBSD PR number 4217.  I have promised to test the card again with a
new snapshot - as soon as I can locate the card again.  From the Dell we could see
an amazing number of networks, almost all unsecured, but that's
another story entirely.</P
><P
>I decided i wanted to try <A
HREF="http://man.openbsd.org/ath"
TARGET="_top"
>ath</A
> cards, and bought a
D-Link DWL-G520, which I then managed to misplace while moving house.
Next, I bought a DWL-G520+, thinking that the plus sign must mean it's
better.  Unfortunately, the plus meant a whole different chipset was
used, the TI ACX111, which comes with a low price tag but with no
documentation accessible to free software developers.  Fortunately the
store let me return the card for a refund with no trouble at all.  At
this point, I was getting rather frustrated, and went all across town
to a shop which had several DWL-AG520 cards in stock.  It was a bit
more expensive than the others, but it did work right away.  A couple
of weeks later the G520 turned up, and of course that worked too.  My
laptop (which at the time ran FreeBSD) came with a Realtek 8180
wireless mini-PCI card built in, but for some reason I could not get
it to work.  I ended up buying DWL-AG650 cardbus card, which works
flawlessly with the <TT
CLASS="FILENAME"
>ath</TT
> driver.  In general, my
advice is, if you shop online, keep the man pages available in another
tab or window, and if you go to a physical store, make sure to tell
the clerks you will be using a BSD, and if you're not sure about the
card they are trying to sell you, see if you can borrow a machine to
browse the online man pages.  Telling the clerks up front could end up
making it easier to get a refund if the part does not work, and
telling them the card did work is good advocacy.</P
><P
>It is possibly worth noting that the <TT
CLASS="FILENAME"
>acx</TT
> driver,
introduced in OpenBSD 4.0, has brought reverse engineered support for
ACX1nn based cards to the BSDs.</P
></TD
></TR
></TABLE
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="wireless.simple.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="vegard.authpf.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Wireless networks made simple</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="wireless.simple.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>An open, yet tightly guarded wireless network with <SPAN
CLASS="APPLICATION"
>authpf</SPAN
></TD
></TR
></TABLE
></DIV
></BODY
></HTML
>